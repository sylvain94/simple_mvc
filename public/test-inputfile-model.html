<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test InputFile Model</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .result { margin: 10px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .success { border-color: #10b981; background: #f0fdf4; color: #059669; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        .status-active { color: green; font-weight: bold; }
        .status-stopped { color: red; }
    </style>
</head>
<body>
    <h1>üß™ Test InputFile Model</h1>
    
    <div class="result">
        <h2>Sample API Response</h2>
        <pre id="sample-data"></pre>
    </div>

    <div class="result">
        <h2>Model Test Results</h2>
        <div id="model-test"></div>
    </div>

    <div class="result">
        <h2>Processed Data</h2>
        <div id="processed-data"></div>
    </div>

    <script type="module">
        // Sample data from your API response
        const sampleApiResponse = [
            {
                "id": "120372d5-26f1-4850-86a5-e57968fcb38d",
                "functionType": "InputFileToTSEntity",
                "name": "Mire 720p",
                "description": null,
                "instanceID": null,
                "command": "ffmpeg",
                "inputType": "FILE",
                "outputType": "UNDEF",
                "outputFilePath": null,
                "outputFileName": null,
                "inputOptions": [
                    "-hide_banner",
                    "-re",
                    "-stream_loop -1",
                    "-fflags +genpts",
                    "-copyts",
                    "-fflags +flush_packets",
                    "-i"
                ],
                "inputParameters": null,
                "inputProtocol": "",
                "outputOptions": [
                    "-c copy",
                    "-f mpegts"
                ],
                "outputParameters": null,
                "outputProtocol": "udp",
                "matchingLinePattern": null,
                "maxMatchingLines": null,
                "maxTestDelay": 30000,
                "runTempoAfterLaunch": 1,
                "inputAnalyzeCommand": null,
                "inputAnalyseMethod": null,
                "inputAnalyzeFormat": "JSON",
                "inputInputAnalyzeOptions": null,
                "outputInputAnalyzeOptions": null,
                "outputAnalyzeCommand": "tsp",
                "outputAnalyseMethod": null,
                "outputAnalyzeFormat": "JSON",
                "inputOutputAnalyzeOptions": null,
                "outputOutputAnalyzeOptions": null,
                "active": true,
                "enabled": true,
                "running": false,
                "auto_run": false,
                "persistent": true,
                "externalID": null,
                "consumedResourceId": null,
                "consumedResourceName": null,
                "technicalServiceID": null,
                "technicalServiceName": null,
                "topologyID": null,
                "procPID": -1,
                "packetSize": 1316,
                "currentOutputSignalNumber": 0,
                "maxOutputSignals": 1,
                "currentInputSignalNumber": 0,
                "maxInputSignals": 0,
                "controlIPAddress": null,
                "controlPort": -1,
                "filePath": "/home/ansible/",
                "fileName": "mire_720p.ts",
                "multicastAddress": "232.0.0.2",
                "multicastPort": 6005,
                "sourceAddress": "192.168.1.20",
                "fullCommand": "ffmpeg -hide_banner -re -stream_loop -1 -fflags +genpts -copyts -fflags +flush_packets -i /home/ansible/mire_720p.ts -c copy -f mpegts udp://232.0.0.2:6005?pkt_size=1316&localaddr=192.168.1.20",
                "statuses": "{\"running\":false,\"active\":true,\"enabled\":true}",
                "autoRun": false,
                "inputSignal": null,
                "outputSignal": null
            }
        ];

        // Display sample data
        document.getElementById('sample-data').textContent = JSON.stringify(sampleApiResponse, null, 2);

        // Simulate InputFile model (simplified for testing)
        class InputFile {
            constructor(data = {}) {
                // Core identification
                this.id = data.id || null;
                this.functionType = data.functionType || 'InputFileToTSEntity';
                this.name = data.name || '';
                this.description = data.description || null;
                
                // File properties
                this.filePath = data.filePath || '';
                this.fileName = data.fileName || '';
                this.inputType = data.inputType || 'FILE';
                this.outputType = data.outputType || 'UNDEF';
                
                // Command and options
                this.command = data.command || 'ffmpeg';
                this.inputOptions = data.inputOptions || [];
                this.outputOptions = data.outputOptions || [];
                this.fullCommand = data.fullCommand || '';
                
                // Network configuration
                this.multicastAddress = data.multicastAddress || '';
                this.multicastPort = data.multicastPort || null;
                this.sourceAddress = data.sourceAddress || '';
                this.packetSize = data.packetSize || 1316;
                this.outputProtocol = data.outputProtocol || 'udp';
                this.inputProtocol = data.inputProtocol || '';
                
                // Status and control
                this.active = data.active !== undefined ? data.active : true;
                this.enabled = data.enabled !== undefined ? data.enabled : true;
                this.running = data.running !== undefined ? data.running : false;
                this.auto_run = data.auto_run !== undefined ? data.auto_run : false;
                this.autoRun = data.autoRun !== undefined ? data.autoRun : false;
                this.persistent = data.persistent !== undefined ? data.persistent : true;
                
                // Process information
                this.procPID = data.procPID || -1;
                this.instanceID = data.instanceID || null;
            }

            get status() {
                if (this.running && this.enabled) return 'Active';
                if (this.running && !this.enabled) return 'Running (Disabled)';
                if (!this.running && this.enabled) return 'Stopped';
                return 'Disabled';
            }

            getStatusBadgeClass() {
                if (this.running && this.enabled) return 'badge-success';
                if (this.running && !this.enabled) return 'badge-warning';
                if (!this.running && this.enabled) return 'badge-error';
                return 'badge-neutral';
            }

            get isActive() {
                return this.running && this.enabled;
            }

            get multicastAddressFormatted() {
                if (this.multicastAddress && this.multicastPort) {
                    return \`\${this.multicastAddress}:\${this.multicastPort}\`;
                }
                return 'Not configured';
            }

            get fullPath() {
                if (this.filePath && this.fileName) {
                    return \`\${this.filePath}\${this.fileName}\`;
                }
                return this.filePath || this.fileName || 'No path specified';
            }

            static fromApiResponse(apiData) {
                return new InputFile(apiData);
            }
        }

        // Test the model
        const testResults = [];
        
        try {
            // Create InputFile from sample data
            const inputFile = InputFile.fromApiResponse(sampleApiResponse[0]);
            
            testResults.push("‚úÖ InputFile model created successfully");
            testResults.push(\`‚úÖ ID: \${inputFile.id}\`);
            testResults.push(\`‚úÖ Name: \${inputFile.name}\`);
            testResults.push(\`‚úÖ Status: \${inputFile.status}\`);
            testResults.push(\`‚úÖ Full Path: \${inputFile.fullPath}\`);
            testResults.push(\`‚úÖ Multicast: \${inputFile.multicastAddressFormatted}\`);
            testResults.push(\`‚úÖ Command: \${inputFile.command}\`);
            testResults.push(\`‚úÖ Is Active: \${inputFile.isActive}\`);
            testResults.push(\`‚úÖ Status Badge Class: \${inputFile.getStatusBadgeClass()}\`);
            
            // Display results
            document.getElementById('model-test').innerHTML = testResults.join('<br>');
            
            // Create a table view like in the Vue component
            const tableHtml = \`
                <h3>üìÅ File Display (as it would appear in Vue)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Path</th>
                            <th>Status</th>
                            <th>Multicast</th>
                            <th>Command</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong>\${inputFile.name}</strong><br>
                                <small>\${inputFile.description || 'No description'}</small>
                            </td>
                            <td>
                                \${inputFile.fullPath}<br>
                                <small>Type: \${inputFile.inputType}</small>
                            </td>
                            <td class="\${inputFile.running && inputFile.enabled ? 'status-active' : 'status-stopped'}">
                                \${inputFile.status}<br>
                                <small>\${inputFile.auto_run ? 'Auto-start' : 'Manual'}</small>
                            </td>
                            <td>
                                \${inputFile.multicastAddressFormatted}<br>
                                <small>Packet: \${inputFile.packetSize}</small>
                            </td>
                            <td>
                                \${inputFile.command}<br>
                                <small>Protocol: \${inputFile.outputProtocol}</small>
                            </td>
                        </tr>
                    </tbody>
                </table>
            \`;
            
            document.getElementById('processed-data').innerHTML = tableHtml;
            
        } catch (error) {
            testResults.push(\`‚ùå Error: \${error.message}\`);
            document.getElementById('model-test').innerHTML = testResults.join('<br>');
        }

        console.log('üß™ InputFile Model test completed');
    </script>
</body>
</html>
