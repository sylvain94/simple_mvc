<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Start Input File</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .btn { padding: 10px 15px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #2563eb; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-success { background: #10b981; }
        .btn-error { background: #ef4444; }
        .result { margin: 10px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .error { border-color: #ef4444; background: #fef2f2; color: #dc2626; }
        .success { border-color: #10b981; background: #f0fdf4; color: #059669; }
        .loading { opacity: 0.6; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        input[type="text"] { padding: 8px; width: 100%; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üöÄ Test Start/Stop Input File</h1>
    
    <div>
        <h2>Configuration</h2>
        <label>API Token: 
            <input type="text" id="apiToken" placeholder="Bearer token" value="">
        </label>
        <label>File ID: 
            <input type="text" id="fileId" placeholder="File ID" value="120372d5-26f1-4850-86a5-e57968fcb38d">
        </label>
        <button onclick="saveConfig()" class="btn">Save Config</button>
    </div>

    <div>
        <h2>Actions</h2>
        <button onclick="testStartFile()" class="btn btn-success" id="startBtn">üöÄ START File</button>
        <button onclick="testStopFile()" class="btn btn-error" id="stopBtn">‚èπÔ∏è STOP File</button>
        <button onclick="testGetFiles()" class="btn" id="getBtn">üìã Get All Files</button>
        <button onclick="clearResults()" class="btn" style="background: #6b7280;">Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        // Load saved config
        document.getElementById('apiToken').value = localStorage.getItem('apiToken') || '';
        document.getElementById('fileId').value = localStorage.getItem('fileId') || '120372d5-26f1-4850-86a5-e57968fcb38d';

        function saveConfig() {
            const token = document.getElementById('apiToken').value;
            const fileId = document.getElementById('fileId').value;
            localStorage.setItem('apiToken', token);
            localStorage.setItem('fileId', fileId);
            addResult('‚úÖ Configuration saved', 'success');
        }

        function getHeaders() {
            const token = localStorage.getItem('apiToken');
            return {
                'Accept': 'text/plain',
                'Content-Type': 'application/json',
                ...(token && { 'Authorization': `Bearer ${token}` })
            };
        }

        async function testStartFile() {
            const fileId = localStorage.getItem('fileId');
            if (!fileId) {
                addResult('‚ùå Please provide a File ID', 'error');
                return;
            }

            setButtonLoading('startBtn', true);
            addResult('üîÑ Starting input file...', 'loading');
            
            try {
                const response = await fetch(\`/api/v1/functions/input_files/startByID/\${fileId}\`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify({})
                });

                const data = await response.text();
                
                addResult(\`
                    <h3>üöÄ START File Response</h3>
                    <p><strong>Status:</strong> \${response.status} \${response.statusText}</p>
                    <p><strong>Headers:</strong></p>
                    <pre>\${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}</pre>
                    <p><strong>Response:</strong></p>
                    <pre>\${data}</pre>
                \`, response.ok ? 'success' : 'error');
                
            } catch (error) {
                addResult(\`
                    <h3>‚ùå START Error</h3>
                    <p>Network error: \${error.message}</p>
                \`, 'error');
            } finally {
                setButtonLoading('startBtn', false);
            }
        }

        async function testStopFile() {
            const fileId = localStorage.getItem('fileId');
            if (!fileId) {
                addResult('‚ùå Please provide a File ID', 'error');
                return;
            }

            setButtonLoading('stopBtn', true);
            addResult('üîÑ Stopping input file...', 'loading');
            
            try {
                const response = await fetch(\`/api/v1/functions/input_files/stopByID/\${fileId}\`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify({})
                });

                const data = await response.text();
                
                addResult(\`
                    <h3>‚èπÔ∏è STOP File Response</h3>
                    <p><strong>Status:</strong> \${response.status} \${response.statusText}</p>
                    <p><strong>Headers:</strong></p>
                    <pre>\${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}</pre>
                    <p><strong>Response:</strong></p>
                    <pre>\${data}</pre>
                \`, response.ok ? 'success' : 'error');
                
            } catch (error) {
                addResult(\`
                    <h3>‚ùå STOP Error</h3>
                    <p>Network error: \${error.message}</p>
                \`, 'error');
            } finally {
                setButtonLoading('stopBtn', false);
            }
        }

        async function testGetFiles() {
            setButtonLoading('getBtn', true);
            addResult('üîÑ Getting all files...', 'loading');
            
            try {
                const response = await fetch('/api/v1/functions/input_files/getAll', {
                    method: 'GET',
                    headers: {
                        'Accept': '*/*',
                        'Authorization': \`Bearer \${localStorage.getItem('apiToken')}\`
                    }
                });

                const data = await response.text();
                
                addResult(\`
                    <h3>üìã Get Files Response</h3>
                    <p><strong>Status:</strong> \${response.status} \${response.statusText}</p>
                    <p><strong>Response:</strong></p>
                    <pre>\${data}</pre>
                \`, response.ok ? 'success' : 'error');

                // Try to parse and show status
                if (response.ok) {
                    try {
                        const files = JSON.parse(data);
                        const targetFile = files.find(f => f.id === localStorage.getItem('fileId'));
                        if (targetFile) {
                            addResult(\`
                                <h3>üìä Target File Status</h3>
                                <p><strong>Name:</strong> \${targetFile.name}</p>
                                <p><strong>Running:</strong> \${targetFile.running ? '‚úÖ YES' : '‚ùå NO'}</p>
                                <p><strong>Enabled:</strong> \${targetFile.enabled ? '‚úÖ YES' : '‚ùå NO'}</p>
                                <p><strong>Active:</strong> \${targetFile.active ? '‚úÖ YES' : '‚ùå NO'}</p>
                            \`, 'success');
                        }
                    } catch (e) {
                        console.log('Could not parse as JSON:', e);
                    }
                }
                
            } catch (error) {
                addResult(\`
                    <h3>‚ùå Get Files Error</h3>
                    <p>Network error: \${error.message}</p>
                \`, 'error');
            } finally {
                setButtonLoading('getBtn', false);
            }
        }

        function setButtonLoading(btnId, loading) {
            const btn = document.getElementById(btnId);
            btn.disabled = loading;
            if (loading) {
                btn.style.opacity = '0.6';
            } else {
                btn.style.opacity = '1';
            }
        }

        function addResult(content, type = '') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = \`result \${type}\`;
            div.innerHTML = \`
                <div style="display: flex; justify-between; align-items: start;">
                    <div style="flex: 1;">\${content}</div>
                    <small style="color: #666;">\${new Date().toLocaleTimeString()}</small>
                </div>
            \`;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Load config on page load
        window.onload = () => {
            console.log('üß™ Start/Stop Input File test page loaded');
            addResult('üöÄ Ready to test Start/Stop operations. Configure your token and file ID first.', 'success');
        };
    </script>
</body>
</html>
